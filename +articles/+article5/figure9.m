%% the trajectory of Particles 6 7 8
clear;
%% Parameters
indir = 'E:\Asym\cold2_ds1\data';
outdir = 'E:\Asym\cold2_ds1\out\Article\Paper5';
prm = slj.Parameters(indir, outdir);

%% particles' id
id6 = '1327536648';
id7 = '887512149';
id8 = '991656158';


%% figures
f=figure('Position',[500,10,1200,800]);
ha=slj.Plot.subplot(4,3,[0.018,0.05],[0.1,0.08],[0.08,0.02]);

%%
particle_trajectory(ha, 1, prm, id6);

particle_trajectory(ha, 2, prm, id7);

particle_trajectory(ha, 3, prm, id8);

%% label
annotation(f,'textbox',...
    [0.1625 0.924000001005828 0.101249997230868 0.0462499989941716],...
    'String',{'Particle 6'},...
    'LineStyle','none',...
    'FontSize',18,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.479166666666667 0.924000001005828 0.101249997230868 0.0462499989941716],...
    'String',{'Particle 7'},...
    'LineStyle','none',...
    'FontSize',18,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.795833333333336 0.924000001005828 0.101249997230868 0.0462499989941716],...
    'String',{'Particle 8'},...
    'LineStyle','none',...
    'FontSize',18,...
    'FontName','Times New Roman');


annotation(f,'textbox',...
    [0.0241666666666672 0.897750000931323 0.042916665636003 0.0437499990686775],...
    'String',{'(a)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.394166666666668 0.879000000931323 0.0437499989445011 0.0437499990686775],...
    'String',{'(b)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.712500000000002 0.879000000931323 0.042916665636003 0.0437499990686775],...
    'String',{'(c)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.0241666666666677 0.679000000931323 0.0437499989445011 0.0437499990686775],...
    'String',{'(d)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.394166666666668 0.655250000931323 0.042916665636003 0.0437499990686775],...
    'String',{'(e)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.730000000000002 0.667750000931323 0.0412499990190069 0.0437499990686775],...
    'String',{'(f)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.024166666666668 0.471500000931323 0.0437499989445011 0.0437499990686774],...
    'String',{'(g)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.395000000000001 0.460250000931322 0.0437499989445011 0.0437499990686774],...
    'String',{'(h)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.711666666666669 0.461500000931322 0.0404166657105088 0.0437499990686774],...
    'String',{'(i)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.0233333333333347 0.266500000931323 0.0404166657105089 0.0437499990686774],...
    'String',{'(j)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.394166666666668 0.250250000931323 0.0437499989445011 0.0437499990686774],...
    'String',{'(k)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');
annotation(f,'textbox',...
    [0.711666666666669 0.250250000931323 0.0404166657105088 0.0437499990686774],...
    'String',{'(l)'},...
    'LineStyle','none',...
    'FontSize',16,...
    'FontName','Times New Roman');

%% save
cd(outdir);
% print('-dpng', '-r300', 'figure9.png');


function particle_trajectory(ha, i, prm, id)
%%
xrange = [0, 60];
norm=0.5*prm.value.mi*prm.value.vA*prm.value.vA;
spcs = 'ic';
FontSize = 12;
%% 
prt=prm.read(['trajh_id',id]);
den=prt.acceleration_direction(prm);
den.x=den.x/norm;
den.y=den.y/norm;
den.z=den.z/norm;
prt=prt.norm_energy(norm);
prt=prt.norm_electric_field(prm);
prt=prt.norm_velocity(prm);
en=prt.acceleration_rate(prm);
en.epara=en.epara/norm*prm.value.wci;
en.eperp=en.eperp/norm*prm.value.wci;

lx=prt.value.time;
% extra.xrange=[lx(1),lx(end)];
hi = ha(i);
axes(hi);
ly.l1=prt.value.k;
ly.l2=prt.value.kx;
ly.l3=prt.value.ky;
ly.l4=prt.value.kz;
extra.LineStyle={'-', '-', '-', '-'};
extra.LineColor={'k', 'r', 'b', 'g'};

if i == 1
extra.legend={'K', 'Kx', 'Ky', 'Kz'};
extra.Location='west';
extra.ylabel=['K',spcs];
end

h=slj.Plot.linen(lx, ly, extra);

if i == 1
set(h,'box','off');
set(h,'Location','west');
else
    delete(h);
end
xlim(xrange);
set(gca,'XTicklabel',[]);
set(gca,'FontSize', FontSize);

axes(ha(i+3));
ly=[];
ly.l1=prt.value.bx;
ly.l2=prt.value.by;
ly.l3=prt.value.bz;
ly.l4=sqrt(ly.l1.^2+ly.l2.^2+ly.l3.^2);
extra.LineStyle={'-', '-', '-', '--'};
extra.LineColor={'r', 'b', 'g', 'k'};

if i == 1
    extra.ylabel='B';
    extra.legend={'Bx', 'By', 'Bz', '|B|'};
    extra.Location='west';
end

h=slj.Plot.linen(lx, ly, extra);

if i == 1
extra=rmfield(extra,'Location');
set(h,'box','off');
set(h,...
    'Position',[0.0880555555555553 0.525178570908878 0.0574999995529651 0.116428568192891]);
else
    delete(h);
end
xlim(xrange);
set(gca,'XTicklabel',[]);
set(gca,'FontSize', FontSize);

axes(ha(i+6));
ly=[];
ly.l1=prt.value.vx;
ly.l2=prt.value.vy;
ly.l3=prt.value.vz;
extra.LineStyle={'-', '-', '-'};
extra.LineColor={'r', 'b', 'g'};

if i == 1
extra.ylabel='Vic';
extra.legend={'Vx', 'Vy', 'Vz'};
extra.Location='west';
end

h=slj.Plot.linen(lx, ly, extra);

if i == 1
extra=rmfield(extra,'Location');
set(h,'box','off');
set(h,...
    'Position',[0.0888888888888893 0.419821427624815 0.056666666244467 0.0885714261446679]);
else
    delete(h);
end
xlim(xrange);
set(gca,'XTicklabel',[]);
set(gca,'FontSize', FontSize);

axes(ha(i+9));
ly=[];
ly.l1=den.x;
ly.l2=den.y;
ly.l3=den.z;
% ly.l4=ly.l1+ly.l2+ly.l3;
% ly.l5=prt.value.k(trange);
extra.LineStyle={'-', '-', '-'};
extra.LineColor={'r', 'b', 'g'};

if i == 1
extra.ylabel=['\Delta K',spcs];
extra.legend={'\int_0^{ t}qVxEx dt', '\int_0^{ t}qVyEy dt', '\int_0^{ t}qVzEz dt'};
extra.Location='northwest';
end

extra.xlabel='\Omega_{ci}t';

h=slj.Plot.linen(lx, ly, extra);
if i == 1
set(h,'box','off');
set(h,...
      'Position',[0.0897222222222227 0.164320274722209 0.101666664903363 0.131428567724569]);
else
    delete(h);
end
xlim(xrange);
set(gca,'FontSize', FontSize);
end